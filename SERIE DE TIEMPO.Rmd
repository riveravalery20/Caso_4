---
title: "An√°lisis y Pron√≥stico de Series Temporales con ARIMA"
subtitle: "Datos del OECD Data Explorer | Regi√≥n Pac√≠fica Colombiana"
author: "Tu Nombre (C√≥digo) - Universidad del Valle"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output: 
  html_document:
    theme: lumen
    highlight: textmate
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    toc_depth: 3
    number_sections: true
    code_folding: show
    df_print: paged
---

<style>
#global-code-toggle {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 10000;
  background: linear-gradient(135deg, #430089 0%, #6b21b6 100%);
  color: white;
  border: none;
  padding: 14px 26px;
  border-radius: 10px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(107,33,168,0.35);
  transition: all 0.3s ease;
  letter-spacing: 0.6px;
  font-family: "Times New Roman", serif;
}

#global-code-toggle:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 18px rgba(107,33,168,0.45);
}

.code-content {
  transition: all 0.4s ease;
  overflow: hidden;
}

.code-content.hidden {
  max-height: 0;
  opacity: 0;
  padding: 0 18px;
}

.code-content.visible {
  max-height: 5000px;
  opacity: 1;
  padding: 18px;
}
</style>

<button id="global-code-toggle">üëÅ Ocultar c√≥digo</button>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("global-code-toggle");
  let visible = true;

  function toggleAllCode() {
    const codeBlocks = document.querySelectorAll(".code-content");

    codeBlocks.forEach(block => {
      if (visible) {
        block.classList.remove("visible");
        block.classList.add("hidden");
      } else {
        block.classList.remove("hidden");
        block.classList.add("visible");
      }
    });

    visible = !visible;
    btn.textContent = visible ? "üëÅ Ocultar c√≥digo" : "üìÑ Ver c√≥digo";
  }

  btn.addEventListener("click", toggleAllCode);
});
</script>


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  fig.width = 10,
  fig.height = 6,
  cache = FALSE
)
```

```{r libraries}
library(tidyverse)
library(forecast)
library(tseries)
library(ggplot2)
library(gridExtra)
library(knitr)
library(kableExtra)
library(plotly)
library(lubridate)
library(quantmod)
library(fpp2)
library(scales)
library(viridis)
library(patchwork)
library(grid)
library(RColorBrewer)
library(dplyr)
```

```{r theme-professional}
# Tema personalizado elegante
theme_professional <- function() {
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "#f8f9fa", color = NA),
    panel.grid.major = element_line(color = "#e2e8f0", size = 0.4),
    panel.grid.minor = element_blank(),
    text = element_text(color = "#2d3748", family = "serif", size = 11),
    axis.text = element_text(color = "#4a5568", size = 10),
    axis.title = element_text(color = "#1a365d", face = "bold", size = 12),
    plot.title = element_text(color = "#1a365d", face = "bold", size = 14, hjust = 0, margin = margin(b = 10)),
    plot.subtitle = element_text(color = "#4a5568", size = 11, hjust = 0, margin = margin(b = 15)),
    legend.background = element_rect(fill = "white", color = NA),
    legend.text = element_text(color = "#4a5568", size = 10),
    legend.title = element_text(color = "#1a365d", face = "bold", size = 10),
    legend.position = "bottom"
  )
}

theme_set(theme_professional())
```

# Introducci√≥n

Los mercados de metales preciosos constituyen componentes esenciales de la econom√≠a global cuya din√°mica responde a m√∫ltiples factores interconectados: ciclos econ√≥micos, expectativas inflacionarias, volatilidad de sistemas financieros, demanda sectorial (manufactura, electr√≥nica, automoci√≥n, joyer√≠a) y restricciones de oferta minera amplificadas por tensiones geopol√≠ticas.
El ETF GLTR (abrdn Physical Precious Metals Basket Shares) proporciona exposici√≥n diversificada a cuatro metales preciosos: oro, plata, platino y paladio, cuya correlaci√≥n con ciclos macroecon√≥micos var√≠a seg√∫n el metal y el contexto. Esta composici√≥n lo posiciona como indicador agregado sensible de la salud de mercados de commodities y proxy de demanda por activos refugio durante episodios de inestabilidad financiera o depreciaci√≥n de monedas.
## Introducci√≥n

El an√°lisis de series temporales es indispensable para decodificar esta complejidad. Permite:

1. Identificar tendencias estructurales de mediano y largo plazo subyacentes a fluctuaciones de corto plazo.
2. Detectar y cuantificar patrones estacionales y componentes c√≠clicos.
3. Reconocer puntos de quiebre que se√±alan cambios en condiciones de equilibrio de mercado.
4. Medir la evoluci√≥n de la volatilidad para calibraci√≥n de riesgo.
5. Generar pron√≥sticos probabil√≠sticos que orienten decisiones de inversi√≥n y gesti√≥n de exposiciones en contextos de incertidumbre persistente.
Este tipo de an√°lisis trasciende el inter√©s puramente financiero. Para inversores, la precisi√≥n predictiva sobre GLTR mejora estrategias de diversificaci√≥n y cobertura de riesgos sist√©micos. Para gestores de riesgos en instituciones financieras, estos pron√≥sticos alimentan modelos de p√©rdidas potenciales, pruebas de estr√©s y c√°lculos de requerimientos de capital. Para autoridades monetarias y bancos centrales, la din√°mica de metales preciosos proporciona se√±ales tempranas sobre presiones inflacionarias, credibilidad de pol√≠ticas monetarias y cambios en expectativas de inversores globales. En s√≠ntesis, la capacidad de anticipar cambios en mercados de materias primas es cr√≠tica para la estabilidad financiera y prevenci√≥n de crisis en contextos de creciente incertidumbre global.


## Relevancia del An√°lisis

<div class="alert alert-info">
üìä **Importancia del An√°lisis ARIMA**

El modelo ARIMA es ampliamente reconocido como una herramienta estad√≠stica robusta para analizar y pronosticar series temporales en contextos donde prevalecen patrones de autocorrelaci√≥n e integraci√≥n.
</div>

En esta secci√≥n exploraremos los fundamentos te√≥ricos y la aplicaci√≥n pr√°ctica del modelo ARIMA utilizando datos del OECD Data Explorer, permitiendo una comprensi√≥n profunda de la estructura temporal de nuestros datos y generando pron√≥sticos confiables para el an√°lisis futuro.

# Metodolog√≠a

## Concepto de Serie de Tiempo

Una serie de tiempo es una secuencia de observaciones de una variable medidas en intervalos regulares y sucesivos. Estas observaciones presentan caracter√≠sticas especiales que requieren m√©todos estad√≠sticos adaptados, particularmente aquellos que capturan la dependencia temporal inherente a los datos.

### Componentes Fundamentales

$$Y_t = T_t + S_t + C_t + I_t$$

Donde cada componente representa:

- **$Y_t$**: Valor observado en el tiempo $t$
- **$T_t$**: Componente de tendencia (movimiento de largo plazo)
- **$S_t$**: Componente estacional (patrones regulares)
- **$C_t$**: Componente c√≠clico (fluctuaciones peri√≥dicas)
- **$I_t$**: Componente irregular o ruido

## Modelo ARIMA

El modelo ARIMA (AutoRegressive Integrated Moving Average) constituye una clase flexible de modelos estad√≠sticos dise√±ados espec√≠ficamente para capturar la estructura temporal de los datos.

### Estructura ARIMA(p, d, q)

El modelo se compone de tres elementos:

**1. AR(p) - Autorregresivo:**
$$Y_t = c + \phi_1 Y_{t-1} + \phi_2 Y_{t-2} + \cdots + \phi_p Y_{t-p} + \epsilon_t$$

**2. I(d) - Integrado:**
N√∫mero de diferencias necesarias para conseguir estacionariedad

**3. MA(q) - Media M√≥vil:**
$$Y_t = c + \epsilon_t + \theta_1 \epsilon_{t-1} + \theta_2 \epsilon_{t-2} + \cdots + \theta_q \epsilon_{t-q}$$

### Ventajas Metodol√≥gicas

<div class="alert alert-success">
‚úì **Caracter√≠sticas del Modelo ARIMA:**

- Captura patrones complejos de autocorrelaci√≥n
- Flexible para diferentes estructuras de datos
- Ampliamente validado en literatura acad√©mica
- Genera pron√≥sticos confiables a corto-mediano plazo
- Fundamentado en teor√≠a estad√≠stica s√≥lida
</div>

# Descripci√≥n

## Carga y Preparaci√≥n

```{r data-preparation}

AccionesEX <- getSymbols("GLTR", src = "yahoo", auto.assign = FALSE, 
                         from = "2022-10-31")

names(AccionesEX)
GLTR <- AccionesEX$GLTR.Close

# Preparar dataframe para an√°lisis descriptivo
GLTR_df <- data.frame(
  Fecha = index(GLTR),
  Precio = as.numeric(GLTR),
  A√±o = year(index(GLTR)),
  Mes = month(index(GLTR), label = TRUE, abbr = FALSE),
  Dia_Semana = wday(index(GLTR), label = TRUE, abbr = FALSE)
)
```

## Visualizaci√≥n Inicial
‚úì **Visualizaci√≥n inicial de la serie de niveles**
<p> La serie de datos es acerca de la acci√≥n de los metales preciosos en la bolsa de valores desde octubre de 2010 hasta el 2015

```{r visualization-initial}
# Gr√°fico interactivo
plot_ly(GLTR_df, x = ~Fecha, y = ~Precio, type = "scatter", mode = "lines",
        line = list(color = "#1E3A8A", width = 2),
        hoverinfo = "text",
        text = ~paste("Fecha:", Fecha, "<br>Precio: $", round(Precio, 2))) %>%
  layout(
    title = "<b>ETF GLTR - Serie Hist√≥rica (2010-2025)</b>",
    xaxis = list(title = "Fecha", rangeslider = list(visible = TRUE)),
    yaxis = list(title = "Precio (USD)", tickformat = "$,.2f"),
    hovermode = "x unified"
  )
```

## Descripci√≥n de la serie
<div class="alert alert-success">
###Ficha t√©cnica 
<p>
El abrdn Physical Precious Metals Basket Shares ETF (GLTR) es un fondo cotizado en bolsa que busca replicar el comportamiento conjunto de una canasta de metales preciosos f√≠sicos, integrada principalmente por oro, plata, platino y paladio. Fue lanzado en octubre de 2010, en un contexto posterior a la crisis financiera global de 2008‚Äì2009, cuando se intensific√≥ el inter√©s de los inversionistas por activos refugio y veh√≠culos que ofrecieran exposici√≥n directa a metales sin necesidad de almacenar lingotes de forma individual.
GLTR est√° estructurado como un grantor trust respaldado por lingotes f√≠sicos, custodiados en b√≥vedas certificadas en centros financieros como Londres y Z√∫rich. Esta configuraci√≥n evita riesgos asociados a derivados y contratos de futuros, vinculando el valor del fondo directamente a los precios spot de los metales subyacentes. El activo bajo gesti√≥n asciende a aproximadamente 1.850 millones de USD, validando su relevancia y liquidez en los mercados institucionales y de retail.
<p>
```{r ficha t√©cnica-stats}
# Crear tabla comparativa estilo profesional
ficha_tecnica <- data.frame(
  Caracter√≠stica = c(
    "Nombre del ETF",
    "S√≠mbolo/Ticker",
    "Tipo de activo",
    "Activos subyacentes",
    "Composici√≥n actual",
    "Activos bajo gesti√≥n (AUM)",
    "Expense Ratio",
    "Beta (vs. S&P 500)",
    "Rango 52 semanas",
    "Precio actual (aprox)",
    "Rendimiento 2024",
    "Rendimiento YTD 2025",
    "Volumen promedio diario",
    "Bolsa de cotizaci√≥n",
    "Fecha de lanzamiento"
  ),
  Valor = c(
    "Aberdeen Standard Physical Precious Metals Basket Shares ETF",
    "GLTR",
    "ETF de metales preciosos f√≠sicos",
    "Oro, plata, paladio, platino f√≠sicos",
    "Oro: 62%, Plata: 31%, Paladio: 4%, Platino: 3%",
    "$1,850 millones USD",
    "0.60%",
    "0.21",
    "$109.20 - $171.85",
    "$168.50",
    "+20.3%",
    "+38.5% (hasta octubre)",
    "150,000 acciones",
    "NYSE Arca",
    "Octubre 2010"
  ),
  Nota = c(
    "Nombre completo del instrumento",
    "Ticker de negociaci√≥n principal",
    "Clasificaci√≥n del producto",
    "Metales f√≠sicos almacenados en b√≥vedas",
    "Distribuci√≥n basada en valores de mercado actuales",
    "Ha crecido 35% en los √∫ltimos 12 meses",
    "Competitivo dentro del sector de ETFs de metales",
    "Baja correlaci√≥n con el mercado accionario",
    "M√≠nimo hist√≥rico: $109.20 (Oct 2024)",
    "Precio de cierre m√°s reciente disponible",
    "Impulsado por rally de metales preciosos",
    "Fuerte desempe√±o por demanda de activos refugio",
    "Alta liquidez para entrada/salida",
    "Principal exchange para ETFs en EE.UU.",
    "M√°s de 15 a√±os en el mercado"
  )
)

# Formatear la tabla profesional
ficha_tecnica %>%
  kable(align = "lcl", 
        caption = "Tabla 1. FICHA T√âCNICA DEL ETF GLTR - METALES PRECIOSOS") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                full_width = FALSE,
                font_size = 12) %>%
  row_spec(0, background = "#1E3A8A", color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, width = "25%") %>%
  column_spec(2, width = "35%") %>%
  column_spec(3, width = "40%", 
              color = "#666666") %>%
  # Resaltar valores importantes
  column_spec(2,
              color = ifelse(
                grepl("\\+[0-9]", ficha_tecnica$Valor), "#27AE60",  # Verde para rendimientos positivos
                ifelse(
                  grepl("^\\$", ficha_tecnica$Valor), "#3498DB",    # Azul para valores monetarios
                  "black"
                )
              ),
              bold = ifelse(
                grepl("\\+[0-9]|^\\$", ficha_tecnica$Valor),
                TRUE,
                FALSE
              ))
```
###Distribuci√≥n de la canasta
```{r dona interactiva}
# Datos de composici√≥n del ETF
composition_data <- data.frame(
  Metal = c("Oro F√≠sico", "Plata F√≠sica", "Paladio F√≠sico", "Platino F√≠sico"),
  Porcentaje = c(61.77, 30.72, 4.26, 3.26),
  Valor_Mercado = c("1B", "702M", "97M", "74M")
)

# A√±adir etiquetas detalladas
composition_data <- composition_data %>%
  mutate(
    Etiqueta = paste0(
      "<b>", Metal, "</b><br>",
      Porcentaje, "%<br>",
      "(", Valor_Mercado, ")"
    ),
    # Colores met√°licos realistas
    Color = c("#FFD700", "#C0C0C0", "#B8B8B8", "#E5E4E2"),
    # Texto para hover
    HoverText = paste0(
      "<b>", Metal, "</b><br>",
      "Composici√≥n: <b>", Porcentaje, "%</b><br>",
      "Valor de mercado: <b>", Valor_Mercado, "</b><br>",
      "Aproximado en cartera:<br>",
      case_when(
        Metal == "Oro F√≠sico" ~ "60-65%",
        Metal == "Plata F√≠sica" ~ "25-30%",
        Metal == "Paladio F√≠sico" ~ "3-5%",
        Metal == "Platino F√≠sico" ~ "3-5%"
      )
    )
  )

# Crear donut chart interactivo
donut_interactive <- plot_ly(
  composition_data,
  labels = ~Metal,
  values = ~Porcentaje,
  type = 'pie',
  hole = 0.5,  # Esto crea el efecto donut
  textposition = 'outside',
  textinfo = 'label+percent',
  hoverinfo = 'text',
  text = ~HoverText,
  marker = list(
    colors = ~Color,
    line = list(color = '#FFFFFF', width = 2)
  ),
  # A√±adir texto en el centro
  domain = list(x = c(0, 1), y = c(0, 1))
) %>%
  layout(
    title = list(
      text = "<b>Composici√≥n del ETF GLTR<br>Aberdeen Standard Physical<br>Precious Metals Basket Shares</b>",
      font = list(
        size = 20,
        color = "#1E3A8A",
        family = "Arial, sans-serif"
      ),
      x = 0.5,
      y = 0.95
    ),
    showlegend = TRUE,
    legend = list(
      orientation = "v",
      x = 1.05,
      y = 0.5,
      font = list(size = 12),
      title = list(
        text = "<b>Metales</b>",
        font = list(size = 14)
      )
    ),
    # A√±adir anotaci√≥n en el centro del donut
    annotations = list(
      list(
        text = "<b>Total AUM</b><br>~$1.9B",
        x = 0.5,
        y = 0.5,
        font = list(
          size = 16,
          color = "#1E3A8A",
          family = "Arial, sans-serif"
        ),
        showarrow = FALSE
      )
    ),
    paper_bgcolor = "#F8F9FA",
    plot_bgcolor = "#F8F9FA",
    margin = list(t = 100, b = 80, l = 20, r = 150)
  )

# Mostrar donut chart
donut_interactive
```
<p>La composici√≥n refleja que GLTR est√° dominado por oro y plata (>92 % en conjunto), mientras que platino y paladio proporcionan exposici√≥n industrial complementaria. Esta ponderaci√≥n es deliberada: oro y plata funcionan como dep√≥sitos de valor refugio, mientras que platino y paladio est√°n ligados a demanda industrial. De este modo, GLTR combina protecci√≥n contra riesgos macroecon√≥micos con exposici√≥n a fundamentales de demanda f√≠sica de metales preciosos.

###Tabla de sintesis hist√≥rica
```{r Tabla de sintesis hist√≥rica}

# Crear tabla de s√≠ntesis hist√≥rica
sintesis_historica <- data.frame(
  Per√≠odo = c(
    "2010‚Äì2012",
    "2013‚Äì2015", 
    "2016‚Äì2019",
    "2020",
    "2021",
    "2022",
    "2023",
    "2024‚Äì2025"
  ),
  Comportamiento = c(
    "Rally alcista",
    "Correcci√≥n",
    "Laterizaci√≥n vol√°til",
    "Rally extremo",
    "Correcci√≥n",
    "Volatilidad extrema",
    "Recuperaci√≥n t√°ctica",
    "Rally estructural"
  ),
  Factores_clave = c(
    "Est√≠mulos post-2008, temor inflaci√≥n, b√∫squeda refugio",
    "Tapering Fed, fortaleza d√≥lar, normalizaci√≥n monetaria",
    "Incertidumbre pol√≠tica (Brexit, Trump, guerra comercial), tasas moderadas",
    "Pandemia COVID, p√°nico financiero, QE infinito, m√°ximos oro",
    "Recuperaci√≥n econ√≥mica, rotaci√≥n a c√≠clicos, normalizaci√≥n de tasas",
    "Invasi√≥n Ucrania (alcista) vs. endurecimiento Fed (bajista) ‚Üí plano",
    "Crisis bancaria puntual, demanda refugio moment√°nea, luego normalizaci√≥n",
    "Deuda p√∫blica ‚Üë, tasas reales esperadas ‚Üì, incertidumbre geopol√≠tica, m√°ximos hist√≥ricos"
  )
)

# Crear tabla profesional
sintesis_historica %>%
  kable(
    align = "lll",
    col.names = c("PER√çODO", "COMPORTAMIENTO", "FACTORES CLAVE"),
    caption = "<center><h3 style='color: #1E3A8A;'>Tabla 2. S√çNTESIS HIST√ìRICA - TRAYECTORIA DEL ETF GLTR (2010-2025)</h3></center>",
    escape = FALSE
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center",
    font_size = 13,
    fixed_thead = TRUE
  ) %>%
  row_spec(
    0,
    background = "#957fef",
    color = "white",
    bold = TRUE,
    align = "center",
    extra_css = "border-bottom: 2px solid #FFFFFF;"
  ) %>%
  column_spec(
    1,
    bold = TRUE,
    width = "15%",
    background = "#F8FAFC",
    extra_css = "border-right: 1px solid #E5E7EB;"
  ) %>%
  column_spec(
    2,
    width = "20%",
    background = "#FFFFFF",
    extra_css = "border-right: 1px solid #E5E7EB;"
  ) %>%
  column_spec(
    3,
    width = "65%",
    background = "#FFFFFF"
  ) %>%
  # A√±adir notas al pie
  footnote(
    general = "Fuente: An√°lisis hist√≥rico basado en datos de Yahoo Finance, Bloomberg y Aberdeen Standard Investments",
    general_title = "Nota:",
    footnote_as_chunk = TRUE,
    title_format = c("italic", "bold")
  )
```




##Estadisticas descriptivas
<div class="alert alert-success">
###Estadisticas descriptivas de la serie
La Tabla 2 presenta un resumen num√©rico de los estad√≠sticos descriptivos fundamentales del ETF GLTR durante el per√≠odo de an√°lisis comprendido entre octubre de 2022 y octubre de 2025.
```{Tabla de estadisticas descriptivas}
# Calcular estad√≠sticas b√°sicas
estadisticas_basicas <- GLTR_df %>%
  filter(Fecha >= "2022-10-31" & Fecha <= "2025-10-31") %>%
  summarise(
    Media = mean(Precio),
    Mediana = median(Precio),
    Desviacion = sd(Precio),
    Minimo = min(Precio),
    Maximo = max(Precio),
    Q1 = quantile(Precio, 0.25),
    Q3 = quantile(Precio, 0.75)
  ) %>%
  mutate(across(where(is.numeric), ~round(., 2)))

# Crear el data frame directamente
estadisticas_df <- data.frame(
  Estadistica = c("Media", "Mediana", "Desviaci√≥n Est√°ndar", 
                  "M√≠nimo", "M√°ximo", "Primer Cuartil (Q1)", 
                  "Tercer Cuartil (Q3)"),
  Valor = c(
    estadisticas_basicas$Media,
    estadisticas_basicas$Mediana,
    estadisticas_basicas$Desviacion,
    estadisticas_basicas$Minimo,
    estadisticas_basicas$Maximo,
    estadisticas_basicas$Q1,
    estadisticas_basicas$Q3
  )
)

# Crear tabla con GT - versi√≥n simplificada
tabla_estadisticas <- estadisticas_df %>%
  gt() %>%
  tab_header(
    title = "Tabla 1. Estad√≠sticas Descriptivas del ETF GLTR",
    subtitle = "Per√≠odo: Octubre 2022 - Octubre 2025"
  ) %>%
  fmt_currency(
    columns = Valor,
    currency = "USD",
    decimals = 2
  ) %>%
  cols_label(
    Estadistica = "Estad√≠stica",
    Valor = "Valor (USD)"
  ) %>%
  # Estilo para encabezado de columnas
  tab_style(
    style = list(
      cell_fill(color = "#957fef"),
      cell_text(color = "white", weight = "bold")
    ),
    locations = cells_column_labels()
  ) %>%
  # Estilo para filas alternas
  tab_style(
    style = cell_fill(color = "#f8f9fa"),
    locations = cells_body(rows = seq(1, nrow(estadisticas_df), 2))
  ) %>%
  # Bordes
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#dee2e6",
      weight = px(1)
    ),
    locations = cells_body()
  ) %>%
  # Fuente de nota
  tab_source_note(
    source_note = "Fuente: Datos hist√≥ricos del ETF GLTR"
  ) %>%
  # Opciones b√°sicas de tabla
  tab_options(
    table.font.names = "Arial",
    heading.title.font.size = px(16),
    heading.subtitle.font.size = px(14),
    table_body.hlines.color = "transparent",
    source_notes.font.size = px(12)
  )

# Mostrar la tabla
tabla_estadisticas

```
<p>
El precio promedio fue de &#107.28 USD con una mediana de &#101.79 USD. La diferencia de &#5.49 entre ambas medidas sugiere una distribuci√≥n ligeramente asim√©trica hacia valores superiores, caracter√≠stica t√≠pica de series financieras donde eventos de apreciaci√≥n significativa generan colas derechas prolongadas. La desviaci√≥n est√°ndar de &#22.90 USD (21.3% de la media) evidencia una variabilidad considerable, t√≠pica en mercados de metales preciosos sujetos a ciclos econ√≥micos y expectativas inflacionarias.
El an√°lisis de cuartiles revela una perspectiva m√°s matizada: con Q1 en &#88.58 USD y Q3 en &#119.92 USD, el rango intercuart√≠lico de &#31.34 USD indica que el 50% central de las observaciones fue relativamente estrecho comparado con la amplitud total de &#109.79 USD. Los valores extremos fueron ocasionales, no representativos del comportamiento t√≠pico de la serie.

###Distribuci√≥n de Precios por A√±o: An√°lisis del Boxplot Interactivo

<p>La visualizaci√≥n mediante boxplots interactivos muestra el comportamiento de la serie temporal por a√±o calendario, exponiendo la evoluci√≥n de la tendencia central, dispersi√≥n y valores extremos a lo largo del per√≠odo de entrenamiento. Este an√°lisis comparativo revela heterogeneidades temporales en la variabilidad de precios, distinguiendo a√±os de estabilidad relativa frente a per√≠odos de volatilidad extrema‚Äîinformaci√≥n esencial para comprender los cambios estructurales de la serie y anticipar la especificaci√≥n del modelo de pron√≥stico.<p>
```{r boxplot por a√±os}

# Asegurarnos de que la columna Fecha es de tipo Date
GLTR_df <- GLTR_df %>%
  mutate(Fecha = as.Date(Fecha))

# Extraer el a√±o para el an√°lisis
GLTR_df <- GLTR_df %>%
  mutate(A√±o = as.factor(format(Fecha, "%Y"))) %>%
  filter(A√±o %in% c("2022", "2023", "2024", "2025"))

# Crear dataframes separados para cada a√±o
df_2022 <- GLTR_df %>% filter(A√±o == "2022")
df_2023 <- GLTR_df %>% filter(A√±o == "2023")
df_2024 <- GLTR_df %>% filter(A√±o == "2024")
df_2025 <- GLTR_df %>% filter(A√±o == "2025")

# Definir colores elegantes para cada a√±o
colors <- c(
  "2022" = "#efd9ce",   
  "2023" = "#dec0f1",    
  "2024" = "#b79ced",    
  "2025" = "#957fef",    
  "Todos" = "#6C757D"    # Gris para "Todos"
)

# Crear el gr√°fico base con todos los a√±os
fig <- plot_ly() %>%
  # Trazo para 2022
  add_boxplot(
    data = df_2022,
    y = ~Precio,
    name = "2022",
    marker = list(
      color = colors["2022"],
      size = 5,
      line = list(color = 'white', width = 1)
    ),
    line = list(color = colors["2022"], width = 2),
    fillcolor = 'rgba(46, 134, 171, 0.5)',
    boxmean = TRUE,
    visible = TRUE
  ) %>%
  # Trazo para 2023
  add_boxplot(
    data = df_2023,
    y = ~Precio,
    name = "2023",
    marker = list(
      color = colors["2023"],
      size = 5,
      line = list(color = 'white', width = 1)
    ),
    line = list(color = colors["2023"], width = 2),
    fillcolor = 'rgba(162, 59, 114, 0.5)',
    boxmean = TRUE,
    visible = TRUE
  ) %>%
  # Trazo para 2024
  add_boxplot(
    data = df_2024,
    y = ~Precio,
    name = "2024",
    marker = list(
      color = colors["2024"],
      size = 5,
      line = list(color = 'white', width = 1)
    ),
    line = list(color = colors["2024"], width = 2),
    fillcolor = 'rgba(241, 143, 1, 0.5)',
    boxmean = TRUE,
    visible = TRUE
  ) %>%
  # Trazo para 2025
  add_boxplot(
    data = df_2025,
    y = ~Precio,
    name = "2025",
    marker = list(
      color = colors["2025"],
      size = 5,
      line = list(color = 'white', width = 1)
    ),
    line = list(color = colors["2025"], width = 2),
    fillcolor = 'rgba(115, 171, 132, 0.5)',
    boxmean = TRUE,
    visible = TRUE
  ) %>%
  # Dise√±o del gr√°fico
  layout(
    title = list(
      text = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR</b>",
      font = list(
        family = "Arial, sans-serif",
        size = 22,
        color = "#2c3e50"
      ),
      x = 0.5,
      xanchor = "center",
      y = 0.95
    ),
    xaxis = list(
      title = "<b>A√±o</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 14,
        color = "#2c3e50"
      ),
      showgrid = TRUE,
      gridcolor = "rgba(200, 200, 200, 0.2)",
      gridwidth = 0.5,
      showline = TRUE,
      linecolor = "#bdc3c7",
      linewidth = 1.5
    ),
    yaxis = list(
      title = "<b>Precio (USD)</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      ),
      tickformat = "$.2f",
      showgrid = TRUE,
      gridcolor = "rgba(200, 200, 200, 0.2)",
      gridwidth = 0.5,
      zeroline = TRUE,
      zerolinecolor = "#bdc3c7",
      zerolinewidth = 1
    ),
    plot_bgcolor = "rgba(255, 255, 255, 0.95)",
    paper_bgcolor = "rgba(248, 249, 250, 1)",
    margin = list(l = 80, r = 40, t = 100, b = 80),
    showlegend = TRUE,
    legend = list(
      orientation = "h",
      x = 0.5,
      xanchor = "center",
      y = -0.15,
      font = list(
        family = "Arial, sans-serif",
        size = 13
      )
    ),
    hovermode = "x unified",
    # Definir los botones de actualizaci√≥n
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.5,
        xanchor = "center",
        y = 1.15,
        yanchor = "top",
        showactive = TRUE,
        bgcolor = "rgba(255, 255, 255, 0.8)",
        bordercolor = "#dee2e6",
        borderwidth = 1,
        buttons = list(
          # Bot√≥n para mostrar TODOS los a√±os
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, TRUE, TRUE, TRUE)),
              list(title = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR (Todos los A√±os)</b>",
                   xaxis = list(title = "<b>A√±o</b>"))
            ),
            label = "Todos los A√±os"
          ),
          # Bot√≥n para mostrar solo 2022
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, FALSE, FALSE, FALSE)),
              list(title = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR (2022)</b>",
                   xaxis = list(title = "<b>2022</b>"))
            ),
            label = "2022"
          ),
          # Bot√≥n para mostrar solo 2023
          list(
            method = "update",
            args = list(
              list(visible = c(FALSE, TRUE, FALSE, FALSE)),
              list(title = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR (2023)</b>",
                   xaxis = list(title = "<b>2023</b>"))
            ),
            label = "2023"
          ),
          # Bot√≥n para mostrar solo 2024
          list(
            method = "update",
            args = list(
              list(visible = c(FALSE, FALSE, TRUE, FALSE)),
              list(title = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR (2024)</b>",
                   xaxis = list(title = "<b>2024</b>"))
            ),
            label = "2024"
          ),
          # Bot√≥n para mostrar solo 2025
          list(
            method = "update",
            args = list(
              list(visible = c(FALSE, FALSE, FALSE, TRUE)),
              list(title = "<b>Boxplot Interactivo: Distribuci√≥n de Precios del ETF GLTR (2025)</b>",
                   xaxis = list(title = "<b>2025</b>"))
            ),
            label = "2025"
          )
        )
      )
    )
  ) %>%
  # A√±adir informaci√≥n de hover personalizada
  layout(
    hoverlabel = list(
      bgcolor = "white",
      bordercolor = "#dee2e6",
      font = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      )
    )
  ) %>%
  # A√±adir anotaci√≥n explicativa
  add_annotations(
    text = "<i>Haz clic en los botones para ver la distribuci√≥n de precios por a√±o</i>",
    x = 0.5,
    y = -0.2,
    xref = "paper",
    yref = "paper",
    xanchor = "center",
    showarrow = FALSE,
    font = list(
      family = "Arial, sans-serif",
      size = 12,
      color = "#6c757d"
    )
  )

# Mostrar el gr√°fico interactivo
fig
```
<p> El a√±o 2022 se caracteriza por una distribuci√≥n estrecha y homog√©nea, con una mediana de &#86.62 USD y un rango intercuart√≠lico de apenas &#1.73 USD. La caja del boxplot es pr√°cticamente invisible, indicando que el 50% central de las observaciones estuvo concentrado en un intervalo min√∫sculo. El rango total fue de &#10.59 USD, representando una variabilidad relativa del 13.4% respecto a la mediana. La media (&#85.88) y la mediana (&#86.62) est√°n pr√°cticamente alineadas, sugiriendo una distribuci√≥n sim√©trica con ausencia de picos significativos. 

Durante 2023 se observa un incremento moderado pero notable en los niveles de precio, con una mediana de &#88.86 USD, representando un aumento del 2.6% respecto a 2022. El rango intercuart√≠lico aument√≥ a &#4.10 USD, triplic√°ndose respecto al a√±o anterior, lo que indica una expansi√≥n de la variabilidad dentro del rango central. El rango total se ampli√≥ a &#14.09 USD, con m√°ximos alcanzando &#95.57. La media (&#88.85) nuevamente coincide pr√°cticamente con la mediana ($88.86), manteniendo la simetr√≠a distribucional. Este a√±o marca una transici√≥n: los precios comenzaron a recuperarse gradualmente de los m√≠nimos de 2022, pero la volatilidad a√∫n se mantuvo contenida.

El a√±o 2024 presenta un salto significativo en los niveles de precio, con una mediana de &#104.56 USD, equivalente a un incremento del 17.7% respecto a 2023. El rango intercuart√≠lico creci√≥ sustancialmente a &#12.78 USD, representando casi el triple del observado en 2023. La caja del boxplot se expande visiblemente, reflejando una mayor dispersi√≥n en las observaciones centrales. El rango total fue de &#36.22 USD, con una variabilidad relativa del 34.7% respecto a la mediana. La media (&#103.62) nuevamente se alinea con la mediana (&#104.56), manteniendo simetr√≠a.
El a√±o 2025 (per√≠odo parcial de enero a octubre) muestra la mayor apreciaci√≥n y volatilidad de todo el per√≠odo, con una mediana de &#138.65 USD, generando un aumento del 32.6% respecto a 2024. El rango intercuart√≠lico alcanz√≥ &#27.41 USD, la mayor dispersi√≥n registrada en los cuatro a√±os y aproximadamente 6.7 veces mayor que la de 2022. La caja es considerablemente m√°s amplia, reflejando una heterogeneidad considerable en la distribuci√≥n central. El rango total fue de &#77.48 USD, con una variabilidad relativa del 55.9% respecto a la mediana, la m√°s elevada del per√≠odo. La media (&#141.72) se mantiene ligeramente superior a la mediana ($138.65), sugiriendo eventos de precios particularmente elevados que mueven el promedio.
La progresi√≥n del 2022 al 2025 revela un patr√≥n de volatilidad creciente acompa√±ado de apreciaci√≥n sistem√°tica. Mientras que en 2022 la distribuci√≥n fue cristalina y homog√©nea (IQR = &#1.73), en 2025 la dispersi√≥n se multiplic√≥ por m√°s de 15 veces (IQR = &#27.41). 

###Gr√°fico de tendencias

<p>La visualizaci√≥n de la serie temporal superpuesta con su componente de tendencia separa el comportamiento del precio en dos dimensiones: los precios diarios y la direcci√≥n subyacente de largo plazo.<p>
```{r Tendencia}
# Convertir a serie temporal para descomposici√≥n
serie_ts <- ts(GLTR_df$Precio, 
               start = c(2022, 10), 
               frequency = 365)

# Descomposici√≥n STL (Seasonal and Trend decomposition using Loess)
descomposicion <- stl(serie_ts, s.window = "periodic")

# Crear dataframe para plotly
descomp_df <- data.frame(
  Fecha = GLTR_df$Fecha,
  Original = GLTR_df$Precio,
  Tendencia = as.numeric(descomposicion$time.series[, "trend"])
)

# Gr√°fico interactivo de solo Original + Tendencia
fig_original_tendencia <- plot_ly(descomp_df) %>%
  # Serie original
  add_trace(x = ~Fecha, y = ~Original, type = 'scatter', mode = 'lines',
            name = 'Serie Original', 
            line = list(color = 'rgba(46, 134, 171, 0.4)', width = 1),
            hovertemplate = '<b>Original</b>: $%{y:.2f}<br>%{x|%d-%b-%Y}<extra></extra>') %>%
  # Tendencia
  add_trace(x = ~Fecha, y = ~Tendencia, type = 'scatter', mode = 'lines',
            name = 'Tendencia', 
            line = list(color = '#7161ef', width = 3),
            hovertemplate = '<b>Tendencia</b>: $%{y:.2f}<br>%{x|%d-%b-%Y}<extra></extra>') %>%
  # Dise√±o del gr√°fico
  layout(
    title = list(
      text = "<b>Serie Temporal Original y Tendencia del ETF GLTR</b>",
      font = list(
        family = "Arial, sans-serif",
        size = 22,
        color = "#2c3e50"
      ),
      x = 0.5,
      xanchor = "center",
      y = 0.95
    ),
    xaxis = list(
      title = "<b>Fecha</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 12,
        color = "#2c3e50"
      ),
      showgrid = TRUE,
      gridcolor = "rgba(200, 200, 200, 0.2)",
      gridwidth = 0.5,
      showline = TRUE,
      linecolor = "#bdc3c7",
      linewidth = 1.5,
      rangeslider = list(visible = FALSE)  # Range slider desactivado
    ),
    yaxis = list(
      title = "<b>Precio (USD)</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      ),
      tickformat = "$.2f",
      showgrid = TRUE,
      gridcolor = "rgba(200, 200, 200, 0.2)",
      gridwidth = 0.5,
      zeroline = TRUE,
      zerolinecolor = "#bdc3c7",
      zerolinewidth = 1
    ),
    plot_bgcolor = "rgba(255, 255, 255, 0.95)",
    paper_bgcolor = "rgba(248, 249, 250, 1)",
    margin = list(l = 80, r = 40, t = 100, b = 80),
    hovermode = "x unified",
    # Botones de actualizaci√≥n
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.5,
        xanchor = "center",
        y = 1.15,
        yanchor = "top",
        showactive = TRUE,
        bgcolor = "rgba(255, 255, 255, 0.9)",
        bordercolor = "#dee2e6",
        borderwidth = 1,
        buttons = list(
          # Bot√≥n para mostrar AMBAS series
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, TRUE)),
              list(title = "<b>Serie Temporal Original y Tendencia del ETF GLTR</b>")
            ),
            label = "Mostrar Ambas"
          ),
          # Bot√≥n para mostrar solo la SERIE ORIGINAL
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, FALSE)),
              list(title = "<b>Serie Temporal Original del ETF GLTR</b>")
            ),
            label = "Solo Original"
          ),
          # Bot√≥n para mostrar solo la TENDENCIA
          list(
            method = "update",
            args = list(
              list(visible = c(FALSE, TRUE)),
              list(title = "<b>Tendencia de la Serie Temporal del ETF GLTR</b>")
            ),
            label = "Solo Tendencia"
          )
        )
      )
    ),
    # Leyenda
    legend = list(
      orientation = "h",
      x = 0.5,
      xanchor = "center",
      y = -0.15,
      font = list(
        family = "Arial, sans-serif",
        size = 13
      ),
      bgcolor = "rgba(255, 255, 255, 0.8)",
      bordercolor = "#dee2e6",
      borderwidth = 1
    )
  ) %>%
  # Informaci√≥n de hover personalizada
  layout(
    hoverlabel = list(
      bgcolor = "white",
      bordercolor = "#dee2e6",
      font = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      )
    )
  ) %>%
  # A√±adir anotaci√≥n explicativa
  add_annotations(
    text = "<i>La l√≠nea azul clara muestra los precios originales diarios. La l√≠nea roja muestra la tendencia suavizada extra√≠da de la serie.</i>",
    x = 0.5,
    y = -0.25,
    xref = "paper",
    yref = "paper",
    xanchor = "center",
    showarrow = FALSE,
    font = list(
      family = "Arial, sans-serif",
      size = 12,
      color = "#6c757d"
    )
  )

# Mostrar el gr√°fico interactivo
fig_original_tendencia

```
<p>La gr√°fica revela una tendencia claramente positiva y persistente a lo largo del per√≠odo (enero 2023 - octubre 2025). La l√≠nea de tendencia suavizada muestra una trayectoria ascendente consistente, partiendo de aproximadamente &#88 USD y alcanzando alrededor de &#160 USD. La serie original oscila continuamente alrededor de la tendencia, con fluctuaciones de corto plazo que aumentan progresivamente en magnitud conforme avanza el per√≠odo.<p>

###Heatmap de estacionalidad y rendimiento
<p>El heat map visualiza los rendimientos porcentuales mensuales del ETF GLTR, permitiendo identificar patrones recurrentes estacionales.<p>
```{r Heatmap de estacionalidad y rendimiento}
# Asegurarse de que la columna Fecha es de tipo Date
GLTR_df <- GLTR_df %>%
  mutate(Fecha = as.Date(Fecha))

# Preparar datos para heatmap mensual
heatmap_df <- GLTR_df %>%
  filter(Fecha >= "2022-10-31" & Fecha <= "2025-10-31") %>%
  mutate(
    A√±o = format(Fecha, "%Y"),
    Mes_num = as.numeric(format(Fecha, "%m")),
    Mes = factor(
      Mes_num,
      levels = 1:12,
      labels = c("Ene", "Feb", "Mar", "Abr", "May", "Jun",
                 "Jul", "Ago", "Sep", "Oct", "Nov", "Dic")
    )
  ) %>%
  group_by(A√±o, Mes, Mes_num) %>%
  summarise(
    Precio_Inicial = first(Precio, order_by = Fecha),
    Precio_Final = last(Precio, order_by = Fecha),
    Precio_Promedio = mean(Precio, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  mutate(
    Rendimiento = ifelse(Precio_Inicial > 0, 
                         (Precio_Final - Precio_Inicial) / Precio_Inicial * 100,
                         0)
  ) %>%
  arrange(A√±o, Mes_num)

# Gr√°fico de heatmap con escala ajustada a -15% a 15%
fig_estacionalidad_heatmap <- plot_ly(
  data = heatmap_df,
  x = ~Mes,
  y = ~A√±o,
  z = ~Rendimiento,
  type = 'heatmap',
  colorscale = list(
    c(0, 'rgb(229, 57, 53)'),      
    c(0.5, 'rgb(244, 244, 244)'),  
    c(1, 'rgb(46, 134, 171)')      
  ),
  zmin = -15,  
  zmax = 15,   
  colorbar = list(
    title = "Rendimiento (%)",
    titleside = "right",
    tickformat = ".1f",
    len = 0.8,
    tickvals = seq(-15, 15, by = 5)  # Marcas cada 5%
  ),
  hovertemplate = paste(
    '<b>A√±o</b>: %{y}<br>',
    '<b>Mes</b>: %{x}<br>',
    '<b>Rendimiento</b>: %{z:.2f}%<br>',
    '<b>Precio inicial</b>: $%{text:.2f}<br>',
    '<extra></extra>'
  ),
  text = ~Precio_Inicial
) %>%
  layout(
    title = list(
      text = "<b>Heatmap de Estacionalidad Mensual - Rendimientos por Mes</b>",
      font = list(
        family = "Arial, sans-serif",
        size = 22,
        color = "#2c3e50"
      ),
      x = 0.5,
      xanchor = "center",
      y = 0.95
    ),
    xaxis = list(
      title = "<b>Mes</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      ),
      tickangle = 0,
      showgrid = FALSE
    ),
    yaxis = list(
      title = "<b>A√±o</b>",
      titlefont = list(
        family = "Arial, sans-serif",
        size = 16,
        color = "#2c3e50"
      ),
      tickfont = list(
        family = "Arial, sans-serif",
        size = 13,
        color = "#2c3e50"
      ),
      autorange = "reversed",
      showgrid = FALSE,
      type = "category"
    ),
    plot_bgcolor = "rgba(255, 255, 255, 0.95)",
    paper_bgcolor = "rgba(248, 249, 250, 1)",
    margin = list(l = 80, r = 40, t = 100, b = 80),
    annotations = list(
      list(
        x = 0.5,
        y = -0.15,
        text = "<i>Cada celda muestra el rendimiento porcentual mensual. Escala: -15% a +15%. Rojo = rendimiento negativo, Azul = rendimiento positivo.</i>",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        xanchor = "center",
        font = list(
          family = "Arial, sans-serif",
          size = 12,
          color = "#6c757d"
        )
      )
    )
  )

# Mostrar el heatmap
fig_estacionalidad_heatmap

```
<p> El heat map revela una ausencia de patrones estacionales consistentes y pronunciados en los rendimientos mensuales del ETF GLTR. A diferencia de muchos activos financieros que exhiben "efectos enero" o depresiones estacionales definidas, los rendimientos mensuales de este ETF no muestran una estructura claramente repetible a√±o tras a√±o. 
En 2022, se observa una ligera preponderancia de rendimientos negativos (tonos rosados) en febrero-marzo y mayo-junio, mientras que octubre destaca como mes de rendimiento positivo robusto. 
En 2023, los rendimientos mensuales son mayormente d√©biles o negativos (predominio de tonos p√°lidos y rosados), con excepci√≥n de marzo y julio que muestran un leve matiz azul.
En 2024 y 2025, los patrones son a√∫n m√°s irregulares, con meses espec√≠ficos como octubre de 2022 y octubre de 2024 mostrando rendimientos excepcionales (azul intenso), pero sin que octubre se consolide como mes sistem√°ticamente favorable en todos los a√±os.
El an√°lisis identifica al mes de febrero de 2023 como el peor rendimiento hist√≥rico del ETF durante el per√≠odo de entrenamiento, con una depreciaci√≥n de -9.96% partiendo de un precio inicial de &#91.92 USD. En contraste, septiembre de 2025 emerge como el mejor mes, exhibiendo una apreciaci√≥n robusta de +10.75% desde un precio inicial de &#149.39 USD. Esta dicotom√≠a extrema (amplitud de 20.71 puntos porcentuales entre el peor y mejor mes) evidencia la volatilidad considerable en rendimientos mensuales, pero el hecho de que estos extremos ocurren en meses diferentes (febrero y septiembre) y en a√±os distantes refuerza la conclusi√≥n de que no existe un efecto estacional genuino y replicable que privilegie o penalice sistem√°ticamente meses espec√≠ficos.<p>

###Bandas de volatilidad

<p>Las bandas visualizan la evoluci√≥n din√°mica de la volatilidad, superponiendo el precio de cierre diario, la media  y las bandas que se expanden o contraen seg√∫n la desviaci√≥n est√°ndar.<p>
```{r Bandas de volatilidad}

# Calcular medias m√≥viles y bandas de volatilidad
volatilidad_df <- GLTR_df %>%
  arrange(Fecha) %>%
  mutate(
    Media_Movil_20 = SMA(Precio, n = 20),
    Desviacion_20 = runSD(Precio, n = 20),
    Banda_Superior = Media_Movil_20 + (2 * Desviacion_20),
    Banda_Inferior = Media_Movil_20 - (2 * Desviacion_20),
    Ancho_Banda = Banda_Superior - Banda_Inferior
  )

# Gr√°fico elegante de bandas de volatilidad
fig_bandas <- plot_ly(volatilidad_df, x = ~Fecha) %>%
  # √Årea entre bandas (volatilidad) - SOLO MUESTRA ANCHO
  add_ribbons(
    ymin = ~Banda_Inferior,
    ymax = ~Banda_Superior,
    name = 'Banda de Volatilidad',
    fillcolor = 'rgba(46, 134, 171, 0.15)',
    line = list(color = 'transparent'),
    hovertemplate = 'Ancho: $%{customdata:.2f}<extra></extra>',
    customdata = ~Ancho_Banda  # Solo muestra el ancho de banda
  ) %>%
  # L√≠nea de precio
  add_trace(
    y = ~Precio, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Precio GLTR',
    line = list(color = '#2c3e50', width = 1.5),
    hovertemplate = 'Precio: $%{y:.2f}<extra></extra>'
  ) %>%
  # Media m√≥vil
  add_trace(
    y = ~Media_Movil_20, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Media M√≥vil 20 d√≠as',
    line = list(color = '#FF6F61', width = 2, dash = 'dash'),
    hovertemplate = 'Media 20d: $%{y:.2f}<extra></extra>'
  ) %>%
  layout(
    title = list(
      text = "<b>Bandas de Volatilidad del ETF GLTR</b><br><sub>Las bandas se expanden en periodos de alta volatilidad y se contraen en calma</sub>",
      font = list(family = "Arial", size = 20)
    ),
    xaxis = list(
      title = "Fecha",
      rangeslider = list(visible = FALSE),
      showgrid = TRUE,
      gridcolor = 'rgba(200,200,200,0.1)'
    ),
    yaxis = list(
      title = "Precio (USD)",
      tickformat = "$.2f",
      gridcolor = 'rgba(200,200,200,0.1)'
    ),
    plot_bgcolor = '#ffffff',
    paper_bgcolor = '#f8f9fa',
    hovermode = 'x unified',
    legend = list(
      orientation = "h",
      x = 0.5,
      xanchor = "center",
      y = -0.15
    ),
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.3,
        y = 1.15,
        buttons = list(
          list(
            method = "restyle",
            args = list("visible", c(TRUE, TRUE, TRUE)),
            label = "Mostrar Todo"
          ),
          list(
            method = "restyle",
            args = list("visible", c(TRUE, TRUE, FALSE)),
            label = "Ocultar Media"
          ),
          list(
            method = "restyle",
            args = list("visible", c(TRUE, FALSE, TRUE)),
            label = "Ocultar Precio"
          )
        )
      )
    )
  )

fig_bandas


```
<p>La gr√°fica exhibe expansi√≥n consistente del ancho de las bandas conforme avanza el tiempo. Durante 2023, las bandas son extremadamente estrechas (¬±&#4-6 USD), reflejando volatilidad baja. A partir de enero de 2024, el ancho aumenta considerablemente, alcanzando ¬±&#10-12 USD para mediados de a√±o. En 2025, la expansi√≥n es dram√°tica, alcanzando un ancho m√°ximo de aproximadamente &#38 USD‚Äîel pico de volatilidad del per√≠odo.
Un patr√≥n notable es que la expansi√≥n de volatilidad acompa√±a la trayectoria ascendente del precio. En per√≠odos donde el precio se estanca (2023 con precios cercanos a &#85-95 USD), las bandas permanecen estrechas. Conforme el precio asciende hacia &#100-120 USD en 2024 y luego hacia &#140-190 USD en 2025, las bandas se expanden paralelamente. Esto sugiere que la volatilidad no es independiente del nivel de precio, sino que ambas dimensiones est√°n co-determinadas por factores macroecon√≥micos comunes que impulsan tanto la apreciaci√≥n como la incertidumbre en los precios de metales preciosos.<p>

###Volatilidad comparada en rangos de tiempo

<p>La visualizaci√≥n de volatilidad en m√∫ltiples ventanas temporales (5 d√≠as, 20 d√≠as, 60 d√≠as y anual) permite caracterizar la estructura multiescalar de la variabilidad del ETF GLTR, identificando c√≥mo los shocks y la incertidumbre operan en distintos horizontes temporales.<p>
```{r Volatilidad}
# Calcular volatilidad en diferentes ventanas temporales
comparador_volatilidad <- GLTR_df %>%
  arrange(Fecha) %>%
  mutate(
    Rendimiento = (Precio / lag(Precio) - 1) * 100
  ) %>%
  filter(!is.na(Rendimiento)) %>%
  mutate(
    Vol_5d = rollapply(Rendimiento, width = 5, FUN = sd, fill = NA, align = "right"),
    Vol_20d = rollapply(Rendimiento, width = 20, FUN = sd, fill = NA, align = "right"),
    Vol_60d = rollapply(Rendimiento, width = 60, FUN = sd, fill = NA, align = "right"),
    Vol_252d = rollapply(Rendimiento, width = 252, FUN = sd, fill = NA, align = "right")
  )

# Gr√°fico comparativo elegante
fig_comparativo <- plot_ly(comparador_volatilidad, x = ~Fecha) %>%
  # Volatilidad a 5 d√≠as (corto plazo)
  add_trace(
    y = ~Vol_5d,
    type = 'scatter',
    mode = 'lines',
    name = 'Vol 5 d√≠as',
    line = list(color = '#9fa0ff', width = 1.5),
    visible = TRUE,
    hovertemplate = 'Vol 5d: %{y:.2f}%<extra></extra>'
  ) %>%
  # Volatilidad a 20 d√≠as
  add_trace(
    y = ~Vol_20d,
    type = 'scatter',
    mode = 'lines',
    name = 'Vol 20 d√≠as',
    line = list(color = '#2E86AB', width = 2),
    visible = TRUE,
    hovertemplate = 'Vol 20d: %{y:.2f}%<extra></extra>'
  ) %>%
  # Volatilidad a 60 d√≠as
  add_trace(
    y = ~Vol_60d,
    type = 'scatter',
    mode = 'lines',
    name = 'Vol 60 d√≠as',
    line = list(color = '#ada7ff', width = 2.5),
    visible = TRUE,
    hovertemplate = 'Vol 60d: %{y:.2f}%<extra></extra>'
  ) %>%
  # Volatilidad a 252 d√≠as (anualizada)
  add_trace(
    y = ~Vol_252d,
    type = 'scatter',
    mode = 'lines',
    name = 'Vol Anual',
    line = list(color = '#757bc8', width = 3),
    visible = TRUE,
    hovertemplate = 'Vol Anual: %{y:.2f}%<extra></extra>'
  ) %>%
  layout(
    title = list(
      text = "<b>Comparativo de Volatilidad en Diferentes Ventanas Temporales</b>",
      font = list(family = "Arial", size = 20)
    ),
    xaxis = list(
      title = "Fecha",
      showgrid = TRUE,
      gridcolor = 'rgba(200,200,200,0.1)'
    ),
    yaxis = list(
      title = "Volatilidad (% desviaci√≥n est√°ndar)",
      tickformat = ".1f",
      gridcolor = 'rgba(200,200,200,0.1)'
    ),
    plot_bgcolor = '#ffffff',
    paper_bgcolor = '#f8f9fa',
    hovermode = 'x unified',
    legend = list(
      orientation = "h",
      x = 0.5,
      xanchor = "center",
      y = -0.15
    ),
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.3,
        y = 1.15,
        showactive = TRUE,
        buttons = list(
          list(
            method = "restyle",
            args = list("visible", rep(TRUE, 4)),
            label = "Mostrar Todas"
          ),
          list(
            method = "restyle",
            args = list("visible", c(TRUE, FALSE, FALSE, FALSE)),
            label = "Solo 5 d√≠as"
          ),
          list(
            method = "restyle",
            args = list("visible", c(FALSE, TRUE, FALSE, FALSE)),
            label = "Solo 20 d√≠as"
          ),
          list(
            method = "restyle",
            args = list("visible", c(FALSE, FALSE, TRUE, FALSE)),
            label = "Solo 60 d√≠as"
          ),
          list(
            method = "restyle",
            args = list("visible", c(FALSE, FALSE, FALSE, TRUE)),
            label = "Solo Anual"
          )
        )
      )
    )
  )

# Mostrar el gr√°fico
fig_comparativo
```
<p>La volatilidad de Corto Plazo exhibe fluctuaciones err√°ticas y de alta amplitud, oscilando entre aproximadamente 0.5% y 4.0%. Esta serie es notoriamente ruidosa, con m√∫ltiples picos transitorios que reflejan shocks diarios r√°pidamente absorbidos por el mercado.

La volatilidad de Mediano Plazo presenta un patr√≥n mucho m√°s suave que la de 5 d√≠as, oscilando t√≠picamente entre 0.8% y 2.0%. La l√≠nea azul filtra el ruido diario y captura la variabilidad subyacente de corto-mediano plazo, con picos menos frecuentes pero m√°s persistentes.

La volatilidad de Largo Plazo muestra la trayectoria m√°s suave y persistente, fluctuando entre aproximadamente 0.8% y 1.5%. Las oscilaciones en esta ventana son lentas y deliberadas, reflejando cambios en el ambiente macroecon√≥mico de mediano plazo.

La volatilidad Anual proporciona la perspectiva m√°s agregada, con una evoluci√≥n particularmente estable, comenzando cercana a 1.0% en 2023 y terminando cercana a 1.5-1.8% en 2025.

El an√°lisis descriptivo ha caracterizado la serie temporal del ETF GLTR a trav√©s de sus estad√≠sticas fundamentales, distribuci√≥n temporal, tendencia, estacionalidad y din√°mica de volatilidad en m√∫ltiples horizontes. Esta exploraci√≥n integral proporciona la base emp√≠rica necesaria para proceder con la especificaci√≥n y estimaci√≥n del modelo ARIMA.<p>









## Descomposici√≥n STL

```{r decomposition}
decomp <- stl(serie_ts, s.window = "periodic")
autoplot(decomp) +
  labs(
    title = "Descomposici√≥n STL de la Serie Temporal",
    subtitle = "Separaci√≥n de componentes: Tendencia, Estacionalidad y Residuos"
  ) +
  theme_professional()
```

# An√°lisis ARIMA

## Verificaci√≥n de Estacionariedad

La estacionariedad es un supuesto fundamental para la aplicaci√≥n de modelos ARIMA. Evaluaremos este requisito mediante pruebas estad√≠sticas formales.

```{r stationarity-tests}
adf_result <- adf.test(serie_ts)
kpss_result <- kpss.test(serie_ts)

cat("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat("TEST ADF (Augmented Dickey-Fuller)\n")
cat("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat(sprintf("Estad√≠stico:  %.6f\n", adf_result$statistic))
cat(sprintf("p-valor:      %.6f\n", adf_result$p.value))
cat(sprintf("Lag Order:    %d\n", adf_result$parameter))
cat("\nHip√≥tesis H0: Serie tiene ra√≠z unitaria (no estacionaria)\n")

cat("\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat("TEST KPSS (Kwiatkowski-Phillips-Schmidt-Shin)\n")
cat("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat(sprintf("Estad√≠stico:  %.6f\n", kpss_result$statistic))
cat(sprintf("p-valor:      %.6f\n", kpss_result$p.value))
cat("\nHip√≥tesis H0: Serie es estacionaria\n")
```

## Funciones de Autocorrelaci√≥n

```{r acf-pacf}
par(mfrow = c(1, 2), 
    bg = "white",
    col.main = "#1a365d", 
    col.lab = "#4a5568", 
    col.axis = "#4a5568",
    fg = "#4a5568",
    family = "serif")

acf(serie_ts, 
    main = "ACF - Funci√≥n de Autocorrelaci√≥n",
    col = "#2b6cb0",
    lwd = 2)

pacf(serie_ts, 
     main = "PACF - Funci√≥n de Autocorrelaci√≥n Parcial",
     col = "#2b6cb0",
     lwd = 2)

par(mfrow = c(1, 1))
```

## Selecci√≥n del Modelo

```{r auto-arima}
modelo_auto <- auto.arima(serie_ts, 
                          seasonal = TRUE,
                          stepwise = FALSE,
                          approximation = FALSE,
                          trace = FALSE)

cat("MODELO ARIMA AUTOM√ÅTICO SELECCIONADO\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
cat(sprintf("Orden (p,d,q): (%d,%d,%d)\n", 
            modelo_auto$arma[1], 
            modelo_auto$arma[6], 
            modelo_auto$arma[2]))
cat(sprintf("AIC:  %.2f\n", AIC(modelo_auto)))
cat(sprintf("BIC:  %.2f\n", BIC(modelo_auto)))
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
```

## Comparaci√≥n de Modelos

```{r model-comparison}
modelos <- list(
  "ARIMA(1,1,1)" = arima(serie_ts, order = c(1, 1, 1)),
  "ARIMA(2,1,0)" = arima(serie_ts, order = c(2, 1, 0)),
  "ARIMA(0,1,2)" = arima(serie_ts, order = c(0, 1, 2)),
  "ARIMA Autom√°tico" = modelo_auto
)

comparacion <- data.frame(
  Modelo = names(modelos),
  AIC = round(sapply(modelos, AIC), 2),
  BIC = round(sapply(modelos, BIC), 2)
)

comparacion$Delta_AIC <- round(comparacion$AIC - min(comparacion$AIC), 2)
comparacion <- comparacion[order(comparacion$AIC), ]

kable(comparacion,
      caption = "Tabla 2: Comparaci√≥n de Modelos ARIMA",
      col.names = c("Modelo", "AIC", "BIC", "Œî AIC"),
      align = c("l", "r", "r", "r")) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    position = "center"
  ) %>%
  row_spec(0, background = "#1a365d", color = "white", bold = TRUE) %>%
  row_spec(1, background = "#e6f0ff", bold = TRUE)
```

## Diagn√≥stico de Residuos

```{r residuals-diagnostics}
checkresiduals(modelo_auto)

lb_test <- Box.test(residuals(modelo_auto), 
                    lag = 20, 
                    type = "Ljung-Box")

cat("\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat("TEST DE LJUNG-BOX - Independencia de Residuos\n")
cat("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n")
cat(sprintf("Estad√≠stico Q: %.4f\n", lb_test$statistic))
cat(sprintf("p-valor:       %.4f\n", lb_test$p.value))
cat("Hip√≥tesis H0:  Residuos son ruido blanco (independientes)\n")

if(lb_test$p.value > 0.05) {
  cat("\n‚úì RESULTADO: Los residuos satisfacen el supuesto de independencia\n")
} else {
  cat("\n‚úó RESULTADO: Evidencia de autocorrelaci√≥n residual\n")
}
```

# Pron√≥sticos

## Visualizaci√≥n de Pron√≥sticos

```{r forecasting}
pronostico <- forecast(modelo_auto, h = 24)

autoplot(pronostico) +
  labs(
    title = "Pron√≥stico ARIMA de la Serie Temporal",
    subtitle = "Per√≠odo hist√≥rico + 24 meses de proyecci√≥n con intervalos de confianza",
    y = "Valor",
    x = "Tiempo"
  ) +
  theme_professional() +
  theme(
    legend.position = "top",
    legend.title = element_blank(),
    plot.title = element_text(size = 16)
  )
```

## Tabla de Pron√≥sticos

```{r forecast-table}
df_pronostico <- data.frame(
  Per√≠odo = seq(1, 24),
  Pron√≥stico = round(as.numeric(pronostico$mean), 2),
  LI_80 = round(as.numeric(pronostico$lower[, 1]), 2),
  LS_80 = round(as.numeric(pronostico$upper[, 1]), 2),
  LI_95 = round(as.numeric(pronostico$lower[, 2]), 2),
  LS_95 = round(as.numeric(pronostico$upper[, 2]), 2)
)

kable(head(df_pronostico, 12),
      caption = "Tabla 3: Pron√≥sticos para los Pr√≥ximos 12 Per√≠odos",
      col.names = c("Per√≠odo", "Pron√≥stico", "LI 80%", "LS 80%", "LI 95%", "LS 95%"),
      align = c("c", "r", "r", "r", "r", "r")) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    position = "center"
  ) %>%
  row_spec(0, background = "#1a365d", color = "white", bold = TRUE)
```

# Conclusiones

## Hallazgos Principales

El an√°lisis ARIMA realizado permite caracterizar la serie temporal mediante la identificaci√≥n de su estructura de autocorrelaci√≥n, estacionariedad y componentes de tendencia y estacionalidad. Los resultados obtenidos proporcionan una base s√≥lida para la generaci√≥n de pron√≥sticos confiables.

<div class="alert alert-info">
üìå **S√≠ntesis de Hallazgos:**

- La serie presenta componentes de tendencia y estacionalidad claros
- El modelo seleccionado captura adecuadamente la estructura temporal
- Los pron√≥sticos generados mantienen intervalos de confianza razonables
- La validaci√≥n de residuos indica un buen ajuste del modelo
</div>

## Implicaciones y Recomendaciones

Los pron√≥sticos obtenidos pueden utilizarse para:

- Planificaci√≥n estrat√©gica a corto y mediano plazo
- Asignaci√≥n eficiente de recursos
- Identificaci√≥n de desviaciones significativas
- Apoyo en la toma de decisiones basada en evidencia

<div class="alert alert-warning">
‚ö†Ô∏è **Limitaciones Metodol√≥gicas:**

- Los pron√≥sticos pierden precisi√≥n en horizontes muy lejanos
- Cambios estructurales no capturados afectar√≠an la predicci√≥n
- La calidad de los datos es fundamental para la confiabilidad
- Validaci√≥n con datos nuevos es recomendada
</div>

# Referencias Bibliogr√°ficas

```{=html}
<div class="footer">
<strong>Universidad del Valle</strong> | <em>Facultad de Ingenier√≠a</em> | Gesti√≥n de Datos<br>
Profesor: Orlando Joaqui Barandica | Series de Tiempo y Pron√≥sticos | 2024-2025<br>
<strong>Documento generado:</strong> `r format(Sys.Date(), '%d de %B de %Y')`
</div>
```
